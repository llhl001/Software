################################ todo 默认 section，一般没有名字，也可以自定义 section name
# 默认段中定义一些公共的属性，当搜索指定 section name 时，先搜索有名字的段，如果配置匹配的 section name，然后才会搜索 default section
HOME                    = .
RANDFILE                = $ENV::HOME/.rnd           # 随机数种子文件，$ENV::HOME <=> 当前环境变量中的 HOME 变量
oid_section             = new_oids

# todo OID 配置，OID = Object Identifier 对象 IDS
[ new_oids ]
testoid1                = 1.2.3.4
testoid2                = ${testoid1}.5.6

# todo TSA 配置， TSA = Timestamp Authority 时间戳认证机构
tsa_policy1 = 1.2.3.4.1
tsa_policy2 = 1.2.3.4.5.6
tsa_policy3 = 1.2.3.4.5.7


################################ shell> openssl ca 命令相关的配置
[ ca ]
default_ca              = default_ca                    # 引用 [ default_ca ] 的配置

[ default_ca ]     
dir                     = /root/kasei/ca                # 证书认证机构根目录
#oid_file                = 
new_certs_dir           = $dir/newcerts                 # 当前 CA 新生成的证书保存目录
certificate             = $dir/rootca.crt.pem           # 当前 CA 的根证书
private_key             = $dir/private/rootca.key.pem   # 当前 CA 的密钥（包含公私钥）
RANDFILE                = $dir/private/.rand            # 随机数种子文件
default_days            = 365                           # 默认签署的证书文件有效期
#default_startdate
#default_enddate
#default_crl_hours
default_crl_days        = 30                            # 默认 CA 颁发的吊销列表的有效期
default_md              = sha384                        # 当前 CA 对文件进行 数字签名 时所使用的 消息摘要算法
database                = $dir/index.txt                # database index file.
unique_subject          = yes                           # no: 当前 CA 允许一个 subject 申请多个证书; yes: 当前 CA 一个 subject 只能申请一个证书
serial                  = $dir/serial                   # 当前 CA 序列号文件，可以设置初始值： shell> echo '01' > serial
crlnumber               = $dir/crlnumber                # 当前 CA 吊销列表序列号
x509_extensions         = crt_ext                       # 引用 [ crt_ext ] 添加到证书中的扩展项
crl_extensions          = crl_ext                       # 引用 [ crl_ext ] 添加到证书吊销列表文件中的扩展项
preserve                = no                            # keep passed DN ordering
#email_in_dn
#msie_hack
policy                  = policy_anything               # 引用 [ policy_anything ] 证书匹配策略
#name_opt
#cert_opt
copy_extensions         = none                          # 生成证书时，扩展项的 copy 行为，value = [none, copy, copyall]; 简单使用时，建议设置为 none 



# man 文件中没有的配置项   
certs                   = $dir/certs                    # 当前 CA 已颁发的证书保存目录
crl                     = $dir/crl.pem                  # 当前 CA 的吊销列表
crl_dir                 = $dir/crl                      # 当前 CA 已颁发的吊销列表保存目录





######## todo CA 策略配置
[ policy_match ]
countryName             = match                         # match 表示请求中填写的该字段信息要和 CA 证书中的匹配
stateOrProvinceName     = match
organizationName        = match
organizationalUnitName  = optional                      # optional 表示该字段信息可提供可不提供
commonName              = supplied                      # supplied 表示该字段信息必须提供
emailAddress            = optional

[ policy_anything ]
countryName             = optional
stateOrProvinceName     = optional
localityName            = optional
organizationName        = optional
organizationalUnitName  = optional
commonName              = supplied
emailAddress            = optional



######## todo CA 默认 中间根证书 扩展项配置
[ proxy_cert_ext ]
basicConstraints                = CA:FALSE
nsCertType                      = client, email, objsign
nsComment                       = "KaseiHaku Intermediate CA Certification"
subjectKeyIdentifier            = hash
authorityKeyIdentifier          = keyid,issuer
subjectAltName                  = email:copy
subjectAltName                  = email:move
issuerAltName                   = issuer:copy
proxyCertInfo                   = critical,language:id-ppl-anyLanguage,pathlen:3,policy:foo       # 中间（代理）证书必须的配置项

######## todo CA 默认用户证书扩展项配置，这些扩展项会在 CA 签署证书请求的时候添加到证书文件中
[ crt_ext ]
basicConstraints                = CA:FALSE              # 该配置是为了避免将一个 用户证书 interpreting(解释) 为一个 CA 证书
keyUsage                        = nonRepudiation, digitalSignature, keyEncipherment     # 客户端证书使用限制
nsCertType                      = server, client, email, objsign    # Netscape(网景公司) 证书类型配置, 表示该证书可以用于任何东西的签名认证，包括 object
nsComment                       = "KaseiHaku Nginx Certification"   
subjectKeyIdentifier            = hash
authorityKeyIdentifier          = keyid,issuer
subjectAltName                  = email:copy
subjectAltName                  = email:move

######## todo 添加到证书吊销列表文件中的扩展项
[ crl_ext ]
issuerAltName                   = issuer:copy
authorityKeyIdentifier          = keyid:always



################################ shell> openssl req 命令相关的配置
[ req ]
# input_password
# output_password
# default_bits
# default_keyfile
# oid_file
# oid_section
# RANDFILE
# encrypt_key
default_md                      = sha384                        # 证书请求文件的默认 消息摘要 算法
string_mask                     = utf8only                      #     
req_extensions                  = v3_nginx_crt_req              # 加入到普通证书请求文件中的扩展项
x509_extensions                 = v3_root_ca_req                # 加入到自签名证书请求文件中的扩展项
# prompt                        = no                            # 表示不提示，直接取配置文件中配置的 distinguished_name
utf8                            = yes                           # 表示 field 字段值使用 utf8 格式解析，否则使用 ascii 码解析
# attributes                    =                               # 废弃
# DN = Distinguish Name; 证书请求文件的唯一性标识
distinguished_name              = req_distinguished_name_root_ca_req            # 用于创建 root ca 证书请求文件，以下三者留一
#distinguished_name              = req_distinguished_name_intermediate_ca_req    # 用于创建 inter ca 证书请求文件
#distinguished_name              = req_distinguished_name_nginx_crt_req          # 用于创建 nginx 证书请求文件

######## todo 添加到证书请求文件中的 subject 信息配置
[ req_distinguished_name_root_ca_req ]
countryName                     = Country Name (2 letter code)                              # 国家名
countryName_default             = KH                                                        # 默认国家名
countryName_min                 = 2                                                         # 国家名最小长度
countryName_max                 = 2                                                         # 国家名最大长度
stateOrProvinceName             = State or Province Name (full name)                        # 省份名
stateOrProvinceName_default     = KH                                                        # 默认省份名           
localityName                    = Locality Name (eg, city)                                  # 城市名
localityName_default            = KH                                                        # 默认城市名
0.organizationName              = Organization Name (eg, company)                           # 公司名
0.organizationName_default      = KH                                                        # 默认公司名
organizationalUnitName          = Organizational Unit Name (eg, section)                    # 部门名
organizationalUnitName_default  = KH                                                        # 默认部门名
commonName                      = Common Name (eg, your name or your server\'s hostname)    # 域名 = rootca.kasei.haku
commonName_max                  = 64                                                        # 最大域名长度
commonName_default              = rootca.kasei.haku                                         # 默认域名
emailAddress                    = Email Address                                             # 邮箱地址 = kasei@kasei.haku
emailAddress_max                = 64                                                        # 最大邮箱地址长度
emailAddress_default            = kasei@kasei.haku                                          # 默认邮箱地址


[ req_distinguished_name_intermediate_ca_req ]
countryName                     = Country Name (2 letter code)                              # 国家名
countryName_default             = KH                                                        # 默认国家名
countryName_min                 = 2                                                         # 国家名最小长度
countryName_max                 = 2                                                         # 国家名最大长度
stateOrProvinceName             = State or Province Name (full name)                        # 省份名
stateOrProvinceName_default     = KH                                                        # 默认省份名           
localityName                    = Locality Name (eg, city)                                  # 城市名
localityName_default            = KH                                                        # 默认城市名
0.organizationName              = Organization Name (eg, company)                           # 公司名
0.organizationName_default      = KH                                                        # 默认公司名
organizationalUnitName          = Organizational Unit Name (eg, section)                    # 部门名
organizationalUnitName_default  = KH                                                        # 默认部门名
commonName                      = Common Name (eg, your name or your server\'s hostname)    # 域名 = interca.kasei.haku
commonName_max                  = 64                                                        # 最大域名长度
commonName_default              = interca.kasei.haku                                        # 默认域名
emailAddress                    = Email Address                                             # 邮箱地址 = haku@kasei.haku
emailAddress_max                = 64                                                        # 最大邮箱地址长度
emailAddress_default            = haku@kasei.haku                                           # 默认邮箱地址



[ req_distinguished_name_nginx_crt_req ]
countryName                     = Country Name (2 letter code)                              # 国家名
countryName_default             = KH                                                        # 默认国家名
countryName_min                 = 2                                                         # 国家名最小长度
countryName_max                 = 2                                                         # 国家名最大长度
stateOrProvinceName             = State or Province Name (full name)                        # 省份名
stateOrProvinceName_default     = KH                                                        # 默认省份名           
localityName                    = Locality Name (eg, city)                                  # 城市名
localityName_default            = KH                                                        # 默认城市名
0.organizationName              = Organization Name (eg, company)                           # 公司名
0.organizationName_default      = KH                                                        # 默认公司名
organizationalUnitName          = Organizational Unit Name (eg, section)                    # 部门名
organizationalUnitName_default  = KH                                                        # 默认部门名
commonName                      = Common Name (eg, your name or your server\'s hostname)    # 域名 = 1291114093.ml
commonName_max                  = 64                                                        # 最大域名长度
emailAddress                    = Email Address                                             # 邮箱地址 = admin@1291114093.ml
emailAddress_max                = 64                                                        # 最大邮箱地址长度


#################### 证书中的 v3 扩展字段配置
######## todo 添加到自签名证书请求文件中的扩展项
[ v3_root_ca_req ]
basicConstraints                = CA:true
subjectKeyIdentifier            = hash
authorityKeyIdentifier          = keyid:always,issuer
keyUsage                        = cRLSign, keyCertSign          # 使用该项表示该证书只能当作 CA 证书，而不能当作 自签名证书
nsCertType                      = sslCA, emailCA                # 该项表示该证书只能当作 CA 证书，不能当作 自签名证书
subjectAltName                  = email:copy
issuerAltName                   = issuer:copy

[ v3_inter_ca_req ]
basicConstraints                = CA:true
subjectKeyIdentifier            = hash
authorityKeyIdentifier          = keyid:always,issuer
keyUsage                        = cRLSign, keyCertSign          # 使用该项表示该证书只能当作 CA 证书，而不能当作 自签名证书
subjectAltName                  = email:copy
issuerAltName                   = issuer:copy

######## todo 添加到用户证书请求文件中的扩展项
[ v3_nginx_crt_req ]
basicConstraints                = CA:FALSE
keyUsage                        = nonRepudiation, digitalSignature, keyEncipherment
subjectAltName                  = @v3_nginx_crt_req_subject_alt_names

[ v3_nginx_crt_req_subject_alt_names ]
DNS.1                           = 1291114093.ml
DNS.2                           = www.1291114093.ml
DNS.3                           = *.1291114093.ml
IP.1                            = 192.168.1.1
IP.2                            = 192.168.69.14
EMAIL.1                         = admin@1291114093    



