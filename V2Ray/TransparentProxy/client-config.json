{
  "log": { "loglevel": "debug"  },
  "inbounds": [
    {
      "tag": "SocksIn",
      "protocol": "socks",
      "port": 12346,
      "listen": "127.0.0.1",
      "settings": {
        "auth": "noauth"
      }
    },
    {
      "tag": "DokodemoDoorIn",
      "protocol": "dokodemo-door",
      "port": 12345,
      "listen": "0.0.0.0",      
      "settings": {
        "network": "tcp,udp",
        "timeout": 300,
        "followRedirect": true,   // 这里要为 true 才能接受来自 iptables 的流量
        "userLevel": 0
      },   
      "sniffing": {
        "enabled": true,      // 透明代理必须开启
        "destOverride": ["http", "tls"]
      }
    }
  ],
  "outbounds": [
    {
      "tag": "wsLadderOut",
      "protocol": "vmess",
      "settings": {
        "vnext": [
          {
            "address": "1291114093.ml",
            "port": 443,
            "users": [
              { "id":"d45499fa-6c4b-3e55-adbb-bd50bc4137b8", "security":"chacha20-poly1305", "alterId":4, "level":0 }
            ]
          }
        ]
      },
      "streamSettings": {
        "network": "ws",
        "wsSettings": {
          "path": "/v2ray/ladder/ws",
 		  "headers": {
    		"Host": "1291114093.ml"
  		  }        
        },
        "security": "tls", 
        "tlsSettings": {
          "serverName": "1291114093.ml"
        },
        "tcpSettings": {
          "header": {
            "type": "none"
          }
        },
        "sockopt": {
          "mark": 128, //这里是 SO_MARK，用于 iptables 识别，每个 outbound 都要配置；255可以改成其他数值，但要与下面的 iptables 规则对应；如果有多个 outbound，最好奖所有 outbound 的 SO_MARK 都设置成一样的数值
          "tcpFastOpen": false,
          "tproxy": "tproxy"
        } 
      }
    }
  ],
  "routing": {
    "domainStrategy": "IPIfNonMatch",
    "rules": [
      {
        "type": "field",
        "network": "tcp,udp",
        "inboundTag": ["DokodemoDoorIn", "SocksIn"],
        "outboundTag": "wsLadderOut"
      }
    ]
  }
}
