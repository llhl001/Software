Concept {
    DNS 查询方式 {
        1. 本机发送 DNS 请求到 DNS 服务器，如果 DNS 服务器自身不知道当前域名对应的 IP ，那么 DNS 服务器会请求上级 DNS 服务器查询，直到查到为止，并逆向返回 DNS 查询结果
        2. 本机发送 DNS 请求到 DNS 服务器，DNS 服务器告诉本机，你可以去问另一台 DNS 服务器B，以此类推，直到查到为止
    }
}

无代理 {
    1. Browser 中输入 www.bilibili.com 点击 Enter
    2. Browser 发起对 www.bilibili.com 这个 Domain 的 DNS 请求( Chrome 会调用系统 API 去发送 DNS 请求，FireFox 使用自己的 API 发送 DNS 请求)
    3. 假设系统设置的 DNS 服务器为 223.5.5.5
    4. 承载 DNS 请求的 UDP 数据包，就会从本机发送到 223.5.5.5
    5. 223.5.5.5 会返回 www.bilibili.com 这个 Domain 对应的 IP 地址
    6. 浏览器向查询到的 IP 地址发起 HTTP/HTTPS 连接
}

开启了 SOCK5 代理 {
    
    1. Browser 中输入 www.bilibili.com 点击 Enter
    2. Browser 发现设置了 SOCK5 代理，
    3. 因为 SOCK5 代理可以直接将 Domain 传给代理服务器处理，所以 Browser 直接把 Domain 放进 SOCKS5 请求中，发送给代理服务器
    4. 代理服务器 VPS(V2Ray) 接收到 SOCKS5 代理的请求数据包，从 SOCKS5 请求数据包中提取出 Domain
    5. V2Ray 根据 SOCKS5 请求中的 Domain，使用系统 API 向 系统配置 的 DNS 发送 DNS 请求，并返回 IP
    6. V2Ray 获取到 IP 后，想该 IP 发起 TCP 连接

}

使用 V2Ray 内置的 DNS 解析 {
    v2ray 默认配置 {
        {
          "dns": {},
          "inbounds":[
            {
              "sniffing": {
                "enabled": true,                        // 需要开启对流量进行域名嗅探，才能使用内置的 DNS
                "destOverride": ["http", "tls"]
              },
            }
          ],
          "routing":{
            # 当配置为 AsIs 时，v2ray 直接向 Domain 发出连接
            # 使用的是：系统的 DNS 来做 DNS 解析
            "domainStrategy": "AsIs",     

            # 当 Domain 没有匹配任何 路由规则时，将 Domian 解析成 IP(A 记录 或 AAAA 记录) 再次匹配路由规则，如果一个 Domain 对应多个 A 记录，会尝试所有 A 记录；解析后的 IP 地址，只用于路由选择，转发的数据包依然使用原始的 Domain
            # 如果 Domain 匹配到了路由规则，那么直接发送数据包到指定的 outbound ，域名使用 系统的 DNS 来解析
            # 如果 Domain 没有匹配到路由规则，需要解析成 IP 再匹配时，使用的是：v2ray.dns 中配置的内置 DNS 来做 DNS 解析
            "domainStrategy": "IPIfNonMatch",  

            # 当碰到任何基于 IP 的路由规则时，将 Domain 立即解析为 IP 进行匹配
            # 使用的是：v2ray.dns 中配置的内置 DNS 来做 DNS 解析
            "domainStrategy": "IPOnDemand",    
          }
        }
    }

    1. Browser 中输入 www.bilibili.com 点击 Enter
    2. Browser 发现设置了 SOCK5 代理，
    3. 因为 SOCK5 代理可以直接将 Domain 传给代理服务器处理，所以 Browser 直接把 Domain 放进 SOCKS5 请求中，发送给代理服务器
    4. 代理服务器 VPS(V2Ray) 接收到 SOCKS5 代理的请求数据包，从 SOCKS5 请求数据包中提取出 Domain
    5. V2Ray 根据 SOCKS5 请求中的 Domain，使用 v2ray 内置的 DNS 来解析域名
    6. 内置的 DNS 发送 UDP 数据包请求对应的 DNS 服务器解析域名（注意该 UDP 流量也会经过路由选择，由匹配到的路由规则，发送到指定的 outbound 上，因此可以将 DNS 请求发送到 VPS，让 VPS 去解析）
    7. v2ray 根据返回的 IP ，将该 Domain 的数据包，发送到返回的 IP 中



}


